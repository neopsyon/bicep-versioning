trigger:
  batch: true
  branches:
    include:
      - '*'

pool:
  vmImage: windows-latest

parameters:
- name: connectedServiceName
  type: string

- name: subscriptionId
  type: string

- name: acrName

variables:
- name: devOpsOrganization
  value: $[replace(replace(variables['System.CollectionUri'], 'https://dev.azure.com/ ', ''), '/', '')]

- name: fileFilterPath
  value: /Templates/Bicep/modules/

  
steps:
  - checkout: self
    clean: true
    persistCredentials: true

  - template: pipelines/steps/publishBicepModule.yaml
    parameters:
      devOpsOrganization: $(devOpsOrganization)
      devOpsProject: $(System.TeamProject)
      subscriptionId: ${{ parameters.subscriptionId }}
      acrName: acrName
      repositoryName: $(Build.Repository.Name)
      connectedServiceName: ${{ parameters.connectedServiceName }} 
      fileFilterPath: $(fileFilterPath)
      